import * as util from 'node:util';

interface RescriptError {
    RE_EXN_ID: string
    _1: string
    Error: Error
}

function isRescriptError(e: unknown): e is RescriptError {
    return (e as RescriptError).RE_EXN_ID !== undefined;
}

export function toMessage(e: Error | unknown) {
    if (e instanceof Error) {
        return e.stack ?? e.message;
    }

    if (isRescriptError(e)) {
        return `Rescript error. ${e.RE_EXN_ID}: ${e._1}. Error: ${e.Error.stack ?? e.Error.message}`
    }

    return "Unknown error." + util.inspect(e)
}

export default {
    toMessage,
}

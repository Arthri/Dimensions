import * as glob from 'glob';
import * as path from 'path';
import {requireNoCache} from 'dimensions/utils';
import Logger from 'dimensions/logger';
import {LogOptions} from 'dimensions/configloader';
import Extension from 'dimensions/extension';

class Extensions {
    static folder: string = "./extensions";

    static loadExtensions(extensionsList: Array<Extension>, options: LogOptions, logging: Logger) {
        glob.sync(`${this.folder}/**/index.js`).forEach((file) => {
            let extension = new (requireNoCache(path.resolve(file), require).default)();
            extensionsList[extension.name] = extension;

            if (options.extensionLoad) {
                if (options.outputToConsole) {
                    console.log(`\u001b[36m[Extension] ${extension.name} ${extension.version} loaded.\u001b[37m`);
                }

                logging.appendLine(`[Extension] ${extension.name} ${extension.version} loaded.`);
            }
        });
    }
}

export default Extensions;